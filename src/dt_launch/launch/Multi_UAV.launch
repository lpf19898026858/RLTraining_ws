<launch>
    <!-- ================================================================ -->
    <!-- ===        Multi-UAV System Launcher (Central Commander)       === -->
    <!-- ================================================================ -->

    <!-- ★★★ Section 1: Global Nodes and Services (Start only ONCE) ★★★ -->

    <!-- Map Generation and Publishing -->
    <node pkg="map_generator" type="yaml_to_map_publisher_node" name="yaml_to_map_publisher" output="screen">
        <param name="yaml_file_path" value="$(find nlp_drone_control)/config/points_of_interest.yaml"/>
        <param name="resolution" value="1.0"/>
        <param name="frame_id" value="map"/>
        <param name="map_topic" value="/map"/>
    </node>

    <!-- VLM Service Node -->
    <node name="vlm_service_node" pkg="vlm_service" type="vlm_service_node" output="screen">
        <!-- Tell the VLM service which camera topics to subscribe to -->
        <rosparam param="camera_topics" subst_value="True">
            - /V_UAV_0/camera/image_raw
            - /V_UAV_1/camera/image_raw
            <!-- Add more UAVs here as needed -->
            <!-- - /V_UAV_2/camera/image_raw -->
        </rosparam>
    </node>

    <!-- Unity TCP Endpoint -->
    <node name="unity_endpoint" pkg="ros_tcp_endpoint" type="default_server_endpoint.py" output="screen">
        <param name="tcp_ip" type="string" value="0.0.0.0"/>
        <param name="tcp_port" type="int" value="10000"/>
    </node>
    
    <!-- POI State Server Node -->
    <node pkg="poi_state_server" type="poi_state_server_node" name="poi_state_server" output="screen">
        <param name="poi_file" value="$(find nlp_drone_control)/config/points_of_interest.yaml"/>
    </node>
        <!-- Hungarian Scheduler Node -->
    <node name="scheduler_node" pkg="uav_scheduler" type="scheduler_node" output="screen"/>

    <!-- ★★★ Section 2: Per-Drone Support Nodes (Start one for each UAV) ★★★ -->
    
    <!-- A* Planner for V_UAV_0 -->
    <group ns="V_UAV_0">
        <node pkg="astar_planner" type="astar_planner_node" name="astar_planner_node" output="screen">
            <param name="waypoint_distance" value="5.0" />
            <param name="pose_topic" value="drone_pose" />
            <param name="goal_topic" value="llm_goal" />
            <param name="waypoint_topic" value="drone_target" />
        </node>
    </group>
    
    <!-- A* Planner for V_UAV_1 -->
    <group ns="V_UAV_1">
        <node pkg="astar_planner" type="astar_planner_node" name="astar_planner_node" output="screen">
            <param name="waypoint_distance" value="7.0" />
            <param name="pose_topic" value="drone_pose" />
            <param name="goal_topic" value="llm_goal" />
            <param name="waypoint_topic" value="drone_target" />
        </node>
    </group>
    
    <!-- Add more A* planners for other UAVs as needed -->
    <param name="/planning/inflation_radius" value="1.5" /> <!-- 无人机半径+安全距离，例如0.5m+1.0m -->
    <!-- ★★★ Section 3: Global Parameters (Load only ONCE) ★★★ -->
    
    <!-- Load the shared POI file -->
    <rosparam command="load" file="$(find nlp_drone_control)/config/points_of_interest.yaml" />

    <!-- Set API keys and other shared configurations -->
    <param name="/deepseek_api_key" value="sk-zk2c3a12508a3f9897f863156c027eadcee68ca63f4ad778" />
    <param name="/system_prompt_file" value="$(find nlp_drone_control)/config/system_prompt.txt" />
    <param name="/doubao_api_key" value="sk-zk2c3a12508a3f9897f863156c027eadcee68ca63f4ad778" />
    <param name="/describe_scene_service" value="/vision_service/describe_scene" />
    <param name="overview_image_path" value="$(find nlp_drone_control)/config/overview.png"/>
        <rosparam param="drone_ids" subst_value="True">
            - V_UAV_0
            - V_UAV_1
            <!-- Add more UAV IDs here as needed -->
            <!-- - V_UAV_2 -->
        </rosparam>        
        
    <!-- ★★★ Section 4: Launch the Central Commander Node (Start only ONCE) ★★★ -->
    <node name="task_executor_node" pkg="nlp_drone_control" type="task_executor_node" output="screen">
        <!-- CRITICAL: Tell the commander which drones it is responsible for -->
        <rosparam param="drone_ids" subst_value="True">
            - V_UAV_0
            - V_UAV_1
            <!-- Add more UAV IDs here as needed -->
            <!-- - V_UAV_2 -->
        </rosparam>        
        <param name="image_save_base_path" value="/home/lpf/docker_shared/rltraining_ws/src/nlp_drone_control/images" />
    </node>
    <node name="llm_fleet_commander" pkg="nlp_drone_control" type="llm_planner_node" output="screen"/>
    




</launch>
